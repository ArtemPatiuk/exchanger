generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum ExchangeStatus {
  PENDING
  WAITING_PAYMENT
  PAID
  COMPLETED
  CANCELLED
}

enum Role {
  USER
  ADMIN
}

enum Provider {
  GOOGLE
}

model User {
  id       String    @id @default(uuid())
  email    String    @unique
  password String?
  provider Provider?
  role     Role[]
  Token    Token[]

  createdAt        DateTime          @default(now()) @map("created_at")
  updatedAt        DateTime          @updatedAt @map("updated_at")
  assets           Asset[]
  exchangeRequests ExchangeRequest[]

  @@map("users")
}

model Token {
  token     String   @unique
  exp       DateTime
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String
  userAgent String   @map("user_agent")

  @@map("tokens")
}

model Asset {
  id               String  @id @default(uuid())
  coin             String
  network          String
  address          String
  withdrawFee      Float
  withdrawMin      Float
  depositDust      Float
  networkSignature String
  imageUrl         String?

  createdBy   User   @relation(fields: [createdById], references: [id])
  createdById String

  usedAsSource ExchangeRequest[] @relation("AssetFromRelation")
  usedAsTarget ExchangeRequest[] @relation("AssetToRelation")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("asset")
}

model ExchangeRequest {
  id     String @id @default(uuid())
  user   User   @relation(fields: [userId], references: [id])
  userId String

  assetFrom   Asset?  @relation("AssetFromRelation", fields: [assetFromId], references: [id])
  assetFromId String?

  assetTo   Asset?  @relation("AssetToRelation", fields: [assetToId], references: [id])
  assetToId String?

  amount       Float
  commission   Float
  exchangeRate Float
  totalSum     Float

  depositAddress   String
  recipientAddress String

  status ExchangeStatus @default(PENDING)

  createdAt DateTime @default(now())
}
